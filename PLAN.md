# 2A 프로토콜 구구단 프로젝트 계획

## 프로젝트 개요
두 개의 독립적인 AI 에이전트가 API를 통해 통신하며 구구단 문제를 해결하는 시스템을 구현합니다. 슈퍼바이저 에이전트가 전체 과정을 조율합니다. 사용자의 구구단 이해도를 높이기 위해 답변에 대한 교육적 설명을 마크다운 형식으로 제공합니다.

## 아키텍처
- **슈퍼바이저 에이전트**: 사용자 요청 처리 및 에이전트 간 조율
- **에이전트1(문제 생성기)**: 포트 5000, 구구단 문제 생성
- **에이전트2(답변기)**: 포트 6001, 문제에 대한 답변 및 설명 제공
- **웹 인터페이스**: 포트 8000, Vue3 기반 채팅 인터페이스로 사용자 요청 입력 및 진행 과정 모니터링

## 작동 흐름
1. 사용자가 채팅창에 "N단 구구단을 진행해줘. 정답이 M에 도달하면 멈춰줘"와 같은 형식으로 요청합니다.
   - 종료 조건(M)이 지정되지 않은 경우, 기본값으로 N×9(9회)까지만 수행합니다.
2. 슈퍼바이저가 요청 해석 후 에이전트1에 지시
3. 에이전트1이 "N×1=" 형태의 문제 생성
4. 에이전트1이 API를 통해 에이전트2에 문제 전송
5. 에이전트2가 문제 해결 후 "N×X=결과값" 형태의 답변과 함께 교육적 설명 제공
6. 결과값이 M 이상이 되면 구구단을 중단하고 "구구단이 끝났습니다" 메시지를 채팅창에 표시합니다.
   - 또는 X가 9에 도달하면 "구구단이 끝났습니다. N단 학습 완료!" 메시지를 표시합니다.
7. 모든 과정이 채팅 인터페이스에 실시간으로 표시됩니다.
8. 설명은 마크다운 형식으로 표시되며, 사용자는 설명 표시 여부를 토글할 수 있습니다.

## 기술 스택
- **FastAPI**: 각 에이전트의 API 엔드포인트 구현
- **Pydantic**: 메시지 형식 검증
- **HTTP/JSON**: 에이전트 간 통신 프로토콜
- **WebSocket**: 실시간 통신 및 모니터링
- **Vue3**: 웹 인터페이스 및 채팅 UI 구현
- **Pinia**: 상태 관리 (Vuex 대체)
- **TailwindCSS**: UI 컴포넌트 및 스타일링
- **Claude API**: 구구단 계산에 대한 교육적 설명 생성 (토큰 제한: 300)
- **Marked/DOMPurify**: 마크다운 렌더링 및 보안 처리

## 핵심 기능
- 표준화된 메시지 형식으로 구조화된 통신
- 각 에이전트의 독립적 실행과 상태 관리
- 확장 가능한 API 기반 아키텍처
- 채팅 인터페이스를 통한 실시간 모니터링 및 사용자 상호작용
- 마크다운 형식의 교육적 설명 제공 및 토글 기능

## 구현 단계
1. ✅ 기본 프로젝트 구조 설정
2. ✅ 각 에이전트 API 서버 구현
3. ✅ 메시지 스키마 정의
4. ✅ 슈퍼바이저 에이전트 구현
5. ✅ Vue3 기반 채팅 인터페이스 구현
6. ✅ 설명 메시지 컴포넌트 및 마크다운 렌더링 구현
7. ✅ 설명 토글 기능 구현
8. ✅ 통합 테스트
9. ✅ 오류 처리 및 로깅 기능 추가

## 모니터링 시스템
- Vue3 기반 채팅 인터페이스를 통해 전체 과정 실시간 모니터링
- 채팅 방식의 사용자 입력 UI 제공
  - 사용자 메시지는 우측에 표시
  - 시스템/에이전트 메시지는 좌측에 표시
- 구구단 문제와 답변이 채팅 메시지 형태로 순차적으로 표시
- 교육적 설명이 마크다운 형식으로 답변 아래에 표시
- 특정 값(M)에 도달하면 "구구단이 끝났습니다" 메시지 표시
- 에이전트 간 통신 내용 시각화
- 각 에이전트 상태 표시 (활성/비활성)
- 시스템 로그 및 오류 메시지 채팅창에 표시

## 채팅 인터페이스 디자인
- 모바일 친화적인 반응형 디자인
- 상단: 에이전트 상태 표시 영역 및 설명 토글 버튼
- 중앙: 채팅 메시지 표시 영역
  - 사용자 요청 (예: "4단 구구단 시작해줘. 정답이 60에 도달하면 멈춰줘")
  - 슈퍼바이저 응답 (예: "4단 구구단을 시작합니다")
  - 문제 생성 (예: "4×1=")
  - 답변 표시 (예: "4×1=4")
  - 설명 메시지 (예: "4는 1개가 4입니다...")
  - 종료 메시지 (예: "정답이 60에 도달했습니다. 구구단이 끝났습니다")
- 하단: 메시지 입력창 및 전송 버튼

## UI 컴포넌트 구조
```
App.vue
├── AgentStatus.vue (에이전트 상태 표시)
└── ChatWindow.vue (채팅 인터페이스)
    └── ExplanationMessage.vue (설명 메시지 컴포넌트)
```

## 마크다운 렌더링 구현
- `marked` 라이브러리: 마크다운을 HTML로 변환
- `DOMPurify`: XSS 방지를 위한 HTML 정화
- 스타일링: 마크다운 요소에 대한 세부 스타일 적용 (헤딩, 목록, 코드 등)

## 슈퍼바이저 에이전트 프롬프트
당신은 구구단 학습 시스템의 슈퍼바이저입니다. 사용자 요청을 해석하고 에이전트들의 작업을 조율합니다.

1. 사용자 요청에서 구구단 단수(N)와 종료 값(M)을 추출합니다.
   - 종료 값(M)이 명시되지 않은 경우, 기본값으로 N×9까지만 진행합니다.
   - 무한 루프를 방지하기 위해 항상 종료 조건을 설정합니다.
2. 에이전트1에게 N단 구구단 생성을 지시합니다.
3. 에이전트1과 에이전트2 사이의 소통을 모니터링합니다.
4. 결과값이 M 이상이 되거나 X가 9에 도달하면 구구단을 중단하도록 에이전트들에게 지시합니다.
5. 중간 진행 상황과 최종 결과를 사용자에게 알립니다.

전체 구구단 과정을 효율적으로 관리하고, 사용자 요청에 정확히 응답합니다.

## 에이전트1 (문제 생성기) 프롬프트
당신은 구구단 문제를 생성하는 에이전트입니다. 슈퍼바이저로부터 단수를 받아 순차적으로 문제를 생성합니다.

1. 슈퍼바이저로부터 "N단 생성"과 같은 지시를 받으면, N단 구구단 문제를 순차적으로 생성합니다.
2. 문제는 "N×1=", "N×2=" 형식으로 생성합니다.
3. 생성한 문제를 JSON 형태로 답변기 에이전트에게 전송합니다: {"problem": "N×X="}
4. 다음 X 값으로 진행할지 슈퍼바이저의 지시를 기다립니다.

정확한 구구단 문제 형식을 유지하고, 슈퍼바이저의 지시에 따라 작동합니다.

## 에이전트2 (답변기) 프롬프트
당신은 구구단 문제의 답을 계산하고 설명하는 에이전트입니다. 문제 생성기로부터 문제를 받아 정확한 답을 계산하고, Claude API를 활용하여 초등학생 수준의 교육적 설명을 제공합니다.

1. 문제 생성기로부터 {"problem": "N×X="} 형식의 JSON 데이터를 받습니다.
2. 수식을 분석하여 N과 X 값을 추출합니다.
3. N×X 계산을 수행합니다.
4. Claude API를 호출하여 계산 결과에 대한 교육적 설명을 생성합니다.
   - 설명은 마크다운 형식으로 생성됩니다.
   - 토큰 제한은 300으로 설정되어 충분한 설명을 제공합니다.
   - 블록 형식의 표현은 제외하고 덧셈 방식으로만 시각화합니다.
5. 계산 결과와 설명을 JSON에 포함하여 반환합니다: {"answer": 결과값, "calculation": "N×X=결과값", "explanation": "마크다운 형식의 설명 텍스트"}
6. 슈퍼바이저가 결과를 검토할 때까지 대기합니다.

항상 정확한 계산을 수행하고, 초등학생이 이해할 수 있는 명확한 설명과 시각적 표현을 제공합니다.

## 예시 사용자 요청
```
4단 구구단 시작해줘. 정답이 60에 도달하면 멈춰줘.
```

또는 종료 조건 없이:
```
4단 구구단 시작해줘.
```

## 예시 시스템 응답 흐름
```
사용자: 4단 구구단 시작해줘. 정답이 60에 도달하면 멈춰줘.
시스템: 4단 구구단을 시작합니다. 정답이 60에 도달하면 멈추겠습니다.
시스템: 4×1=
시스템: 4×1=4
시스템 (설명): 4는 1개가 4입니다. 즉 4×1=4입니다.

시스템: 4×2=
시스템: 4×2=8
시스템 (설명): 4를 2번 더하면 4+4=8이 됩니다. 두 그룹의 4개씩 사과가 있다고 생각하면, 전체 사과는 8개입니다.

...

시스템: 4×15=
시스템: 4×15=60
시스템 (설명): 4를 15번 더하면 60이 됩니다. 4+4+4+...+4(15번) = 60
시스템: 정답이 60에 도달했습니다. 구구단이 끝났습니다.
```

## 추가 개선 항목 (미구현)
1. **MessageGroup 컴포넌트**: 답변과 설명을 함께 그룹화하는 컴포넌트
2. **개별 설명 토글 기능**: 각 설명 메시지를 개별적으로 토글할 수 있는 기능
3. **코드 블록 하이라이팅**: 마크다운의 코드 블록에 대한 구문 강조 기능
4. **테마 지원**: 라이트/다크 테마 전환 기능
5. **모바일 대응 강화**: 모바일 친화적 UI 최적화
6. **접근성 개선**: 키보드 네비게이션, 스크린 리더 지원 등